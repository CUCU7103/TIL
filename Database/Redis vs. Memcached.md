# Redis vs. Memcached



## Redis란?

- [**Redis(REmote DIctionary Server)(IBM 외부 링크)는 주로 애플리케이션 캐시나 빠른 응답 속도를 가진 데이터베이스로 사용되는 In-memory database 입니다.**

### Redis의 특징

- key-value 형식으로 데이터를 저장합니다.

  - key-value구조 데이터:
    - mysql 같은 관계형 데이터가 아닌 비 관계형 구조로서 데이터를 그저 '키-값' 형태로 단순하게 저장하는 구조

- **디스크가 아닌 메모리에 데이터를 저장하기 때문에 응답 속도가 매우 빠릅니다**.

- **Persistence** 

  - 데이터를 영속화 할 수있도록 2가지 방법을 제시합니다.

  - **RDB**(Redis 데이터베이스):

    - RDB 지속성은 지정된 간격으로 데이터 세트의 특정 시점 스냅샷을 수행합니다.

  - **AOF**(Append Only File):

    - AOF 지속성은 서버에서 수신한 모든 쓰기 작업을 기록합니다.
    - 이러한 작업은 서버 시작 시 다시 재생하여 원래 데이터 세트를 재구성할 수 있습니다.
    - 명령은 Redis 프로토콜 자체와 동일한 형식을 사용하여 기록됩니다.

  - **지속성 없음**

    : 지속성을 완전히 비활성화할 수 있습니다. 이것은 때때로 캐싱할 때 사용됩니다.

  - **RDB + AOF**

    : 동일한 인스턴스에서 AOF와 RDB를 결합할 수도 있습니다.

- **String, Lists, Sets, Sorted Sets, Hashes 등의 자료 구조를 지원합니다.**

![image](https://github.com/user-attachments/assets/58ca0167-5e00-42df-b57a-81a8aece9c1d)


- **Single Threaded **
  - **단일 thread에서 모든 task 처리**

- **Cluster Mode** 

  - **다중 노드에 데이터를 분산 저장하여 안정성 & 고가용성 제공**

    

**사용하는 이유**

- 데이터 베이스가 있는데도 Redis 라는 인메모리 데이터 구조 저장소를 사용하는 이유는 무엇일까요?

  - 일반적인 DB는 데이터를 물리 디스크에 직접 쓰기 때문에 서버에 문제가 발생하여 다운되더라도 데이터가 손실되지 않습니다.
  - 하지만 매번 디스크에 접근해야 하기 때문에 사용자가 많아질수록 부하가 많아져서 느려질 수 있습니다.
  - 일반적으로 서비스 운영 초반이거나 규모가 작은, 사용자가 많지 않은 서비스의 경우에는 **WEB - WAS - DB** 의 구조로도 데이터 베이스에 무리가 가지 않습니다.
  - 하지만 사용자가 늘어나서 트래픽이 증가한다면 데이터베이스가 과부하 될 수 있기 때문에 이때 캐시 서버를 도입하여 사용합니다.
  - 그리고 이 캐시 서버로 이용할 수 있는 것이 바로 **Redis** 입니다.

  

> **캐시란?**
>
> Cache란 한번 조회된 데이터를 **미리 특정 공간에 저장**해놓고, 똑같은 요청이 발생하게 되면 서버에게 다시 요청하지 말고 **저장해놓은 데이터를 제공해서 빠르게 서비스를 제공**해주는 것을 의미합니다
>
> 같은 요청이 여러 번 들어오는 경우 매번 데이터베이스를 거치는 것이 아니라 캐시 서버에서 첫 번째 요청 이후 저장된 결괏값을 바로 내려줍니다
>
> 때문에 DB의 부하를 줄이고 서비스의 속도도 느려지지 않는 장점이 있습니다

### 캐시의 구조 패턴

- **Look aside Cache 패턴**
  - 캐시를 사용하는 패턴은 첫 번째로 Look aside Cache 패턴이다.
  - 위에서 말한 일반적인 캐시 정의를 그대로 구현한 구조이다.
  - look aside cache는 캐시를 한 번 접근하여 데이터가 있는지 판단한 후, 있다면 캐시의 데이터를 사용하고 없으면 실제 DB 또는 API를 호출합니다.
- **[Look aside Cache 쿼리 순서]**
  1. 클라이언트에서 데이터 요청
  2. 서버에서 캐시에 데이터 존재 유무 확인
  3. 데이터가 있다면 캐시의 데이터 사용 (빠른 조회)
  4. 데이터가 없다면 실제 DB 데이터에 접근
  5. 그리고 DB에서 가져 온 데이터를 캐시에 저장하고 클라이언트에 반환

![image](https://github.com/user-attachments/assets/0dc1730d-d6c8-4287-bf9e-471695e9e809)


**Write Back 패턴**

- write back은 주로 쓰기 작업이 굉장히 많아서,INSERT 쿼리를 일일이 날리지 않고 한꺼번에 **배치 처리를 하기 위해 사용**합니다.

**[write back 쿼리 순서]**

1. 모든 데이터를 캐시에 전부 저장
2. 캐시의 데이터를 일정 주기마다 DB에 한꺼번에 저장 (배치)
3. DB에 저장한 뒤  잔존 데이터를 캐시에서 제거

![image](https://github.com/user-attachments/assets/3881f1c8-ae97-4f1a-8a78-42533b40c23e)



### Redis  활용사례

- 세션 스토리지

  - 서버 분산 처리 환경에서의 세션 불일치 문제를 해결하는데 사용되어집니다.

- Caching 

  - 임시 비밀번호(One-Time Password) 
  - 로그인 세션(Session)   

-  Rate Limiter

  - Fixed-Window / Sliding-Window Rate Limiter(비율 계산기)

- Message Broker

  -  메시지 큐(Message Queue)

- 실시간 분석 / 계산

  - 순위표(Rank / Leaderboard) 
  - 반경 탐색(Geofencing) 
  - 방문자 수 계산  (Visitors Count) 

- 실시간 채팅

  - Pub/Sub 패턴

  

## Memcached

1. 데이터베이스 부하를 줄여 동적 웹 애플리케이션의 속도를 개선합니다.
2. Key-value 형태로 데이터를 메모리에 저장합니다.
3. 문자열 데이터만 지원하며, HTML과 같은 작고 정적인 데이터 캐싱에 적합합니다

**Memcached의 핵심 구조**

1. 캐시 데이터 구조:
   - key, value, 만료 시간 등의 정보를 포함
2. Hash Table:
   - 빠른 데이터 검색을 위해 사용
3. Slab Allocator
   - 효율적인 메모리 관리를 담당
4. LRU (Least Recently Used) 리스트
   - 캐시가 가득 찼을 때 제거할 항목 결정

### Memcached의 특징

- `멀티스레드`를 지원하기 때문에, `멀티프로세스코어`를 사용할 수 있습니다. 
  - 따라서, 스케일업을 통하여 더욱 많은 작업처리를 할 수 있습니다

### **Redis / Memcached 비교**

|                  | **Redis**                                                    | **Memcached**                                                |
| ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 코어             | 싱글 코어                                                    | 멀티 코어                                                    |
| 자료구조         | Strings, Set,Sorted-Set, Hashes 등 다양한 자료구조 지원      | Strings, Intergers만 지원                                    |
| 데이터 저장      | Memory, Disk                                                 | Memory                                                       |
| 속도             | 읽기, 쓰기 속도가 Memcached보다 느림 하지만 큰 차이는 없습니다. | 디스크를 거치지 않기 때문에 읽기, 쓰기 속도가 Redis보다 빠릅니다. |
| 복제             | Master-Slave, Multi-Master Replication 방식 지원             | 지원 X                                                       |
| 내구성           | Memcached보다 내구성이 뛰어남                                | Redis보다 내구성이 떨어짐                                    |
| 영속성           | 영속성 데이터 사용                                           | 지원 X                                                       |
| 파이셔닝 방법    | 샤딩 지원                                                    | 지원 X                                                       |
| 메모리 재사용    | 메모리를 재사용하지 않음, 명시적으로만 데이터 제거 가능      | 저장소 메모리를 재사용. <br />만료전에 더 이상 데이터를 넣을 메모리가 없으면 LRU 알고리즘에 따라 데이터 삭제 |
| 만료일 지정 방식 | 만료일을 지정하면 만료된 데이터는 캐시처럼 사라짐            | 동일                                                         |
