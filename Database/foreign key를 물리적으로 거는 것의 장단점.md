# foreign key 물리적으로 거는것의 장단점

> [!NOTE]
>
> #### 실무에서는 fk를 걸어서 db를 사용하는 방법을 지양하고 있습니다 
>
> #### fk를 걸어서 생기는 이점보다 단점이 더 크다고 생각되어지기 때문입니다



## fk를 걸어서 생기는 장점

### 1. 데이터 정합성이 높아집니다.

- 데이터 정합성이란 <u>**어떤 데이터들이 값이 서로 일치하는 상태를 의미합니다**.</u>

- 예시

  - **'술을 마시고(음주여부 : Y) 운전을 했지만(운전여부 : Y) 음주운전을 하지 않았다.(음주여부와 운전여부가 모두 Y이면 음주운전여부도 Y가되야함)'가 정합성이 지켜지지 않은 대표적인 사례**

  - **사원정보 테이블의 사원번호를 1에서 -1로 변경하였는데 부서정보 테이블의 사원번호가 변경되지 않았을 경우 데이터 정합성이 깨졋다고 할 수있습니다.**
  - 반대로 사원정보 테이블의 사원정보를 1에서 2로 변경하였을 때 부서정보 테이블의 사원번호가 변경되었다면 정합성이 유지되었다고 할 수 있습니다.

![image-20241029223859725](C:\Users\syste\AppData\Roaming\Typora\typora-user-images\image-20241029223859725.png)

### 2. 스키마를 통해서 테이블 간의 관계를 명확히 할 수 있습니다.

- 다이어그램을 통해 보았을 때 명확하게 테이블 간의 관계를 확인할 수 있습니다.



## fk를 사용하므로 써 생기는 단점

### 1. **실무에서는 데이터를 수작업으로 다루는 경우가 상당히 많습니다.** 

### (개발 단계에서의 편의성이 매우 저하되어진다.)

- 이러한 상황에서 테이블의 관계상 데이터 생성 순서가 맞지 않으면 수정, 삭제 등의 작업을 진행하는데 매우 번거롭습니다.

- 개발자는 테이블 간의 관계를 파악하고 일일이 테이블 생성 순서에 맞추어서 수정해야합니다.

- 즉 수정과 생성 등 개발의 편의성이 매우 떨어집니다.

  

### 2. **데이터베이스의 확장이 어렵습니다**

- 데이터베이스의 설계를 초기에 잘 해놓었더라도 시간이 지나면서 추가적인 요구사항에 따른 개발이 발생하면 설계가 변경되어야 하는 경우가 발생합니다. 이때 데이터 정합성을 유지하기 위한 외래키로 인해서 더 큰 수정 작업을 해야할 가능성이 생깁니다.

### 3. 성능 저하가 발생합니다.

- FK도 하나의 제약조건으로 데이터를 삽입하는 과정에 있어서 DBMS는 항상 FK를 검사하는 추가적인 과정을 거칩니다.
- 삭제, 수정하는 과정에도 외래 키 옵션에 따라 추가적인 과정이 소요된다



## 가장 큰 이유는 1번이라고 생각합니다.

- 실무에서 데이터베이스 설계가 변경되고, 테이블이 추가되고, 테이블에 직접적으로 데이터를 수정, 추가하는 작업이 빈번하게 발생하였습니다. 
- 만일 fk를 물리적으로 사용하였을때 테이블이 수십 개가 넘어간다고 한다면, 단순하게 테이블의 컬럼 값을 수정하더라도 테이블간 관계와 이에 따른 생성시점을 생각하면서 하위 테이블의 데이터를 처리하고 작업해야하기에 굉장히 편의성이 떨어진다고 볼 수있습니다.

join을 사용해서 연관되어진 테이블의 데이터를 가져올 수 있고, 어플리케이션의 비즈니스 로직을 통해서 데이터 정합성을 맞춰줄 수 있다고 생각합니다.

그래서 정말로 fk 사용이 강제되어지는 조건이 아니라면 저는 fk 사용을 지양할 것 같습니다.

