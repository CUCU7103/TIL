# 연관관계 정리하기

```java
@Entity
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Table(name = "customer_group")
@ToString(exclude = "customerManagements")
public class CustomerGroup {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "customer_group_id")
    private int customerGroupId;

    @Column(name = "customer_group1")
    private String customerGroup1;

    @Column(name = "customer_group2")
    private String customerGroup2;

    @Column(name = "customer_hi_group")
    private String customerHiGroup;

    @Column(name = "customer_group1_name")
    private String customerGroup1Name;

    @Column(name = "customer_group2_name")
    private String customerGroup2Name;

    @Column(name = "customer_hi_group_name")
    private String customerHiGroupName;

    @Column(name = "company_code")
    private String companyCode;

    @Column(name = "etc_desc")
    private String etcDesc;

    @Column(name = "use_yn")
    private String useYn;

    @OneToMany(mappedBy = "customerGroup", cascade = CascadeType.PERSIST)
    private List<CustomerManagement> customerManagements = new ArrayList<>();

    // 연관관계 편의 메서드
    public void addCustomerManagement(CustomerManagement customerManagement) {
        customerManagements.add(customerManagement);
        customerManagement.setCustomerGroup(this);
    }


    public void addCustomerManagement(List<CustomerManagement> customerManagement) {
        for (CustomerManagement m : customerManagement) {
            addCustomerManagement(m);
        }
    }

    public void removeCustomerManagement(CustomerManagement customerManagement) {
        customerManagements.remove(customerManagement);
        customerManagement.setCustomerGroup(null);
    }

    @Builder
    public CustomerGroup(String customerGroup1, String customerGroup2, String customerHiGroup, String customerGroup1Name,
                         String customerGroup2Name, String customerHiGroupName, String companyCode, String etcDesc, String useYn) {
        this.customerGroup1 = customerGroup1;
        this.customerGroup2 = customerGroup2;
        this.customerHiGroup = customerHiGroup;
        this.customerGroup1Name = customerGroup1Name;
        this.customerGroup2Name = customerGroup2Name;
        this.customerHiGroupName = customerHiGroupName;
        this.companyCode = companyCode;
        this.etcDesc = etcDesc;
        this.useYn = useYn == null ? "Y" : useYn;
    }

}

```





``` java
@Data
@NoArgsConstructor
@Entity
@Table(name = "customer_management")
public class CustomerManagement implements Serializable {

    @Id
    @Column(name = "customer_code")
    private String customerCode;
    @Column(name = "business_number")
    private String businessNumber;
    @Column(name = "business_name")
    private String businessName;
    @Column(name = "company_code")
    private String companyCode;
    @Column(name = "boss_name")
    private String bossName;
    @Column(name = "place_name")
    private String placeName;
    @Column (name ="business_type")
    private String businessType; // 업태
    @Column (name ="business_stat")
    private String businessSectors; // 업종
    @Column(name= "sales_purchase")
    private String salesPurchase;
    @Column(name = "customer_manager")
    private String customerManager;
    @Column(name = "tel_number")
    private String telNumber;
    @Column(name = "fax_number")
    private String faxNumber;
    @Column(name = "email")
    private String email;
    @CreationTimestamp
    @JsonFormat(shape = JsonFormat.Shape.STRING, pattern = "yyyy-MM-dd HH:mm:ss", timezone = "Asia/Seoul")
    @Column(name = "register_ts")
    private LocalDateTime registerTs;
    @Column(name = "etc_desc")
    private String etcDesc;
    @Column(name = "use_yn")
    private String useYn;
    @Column(name= "company_address")
    private String companyAddress;
    @Column(name = "employ_code")
    private String employCode;
    @Column(name = "customer_type")
    private String customerType;
    @Column(name = "customer_group1")
    private String customerGroup1;
    @Column(name = "customer_group2")
    private String customerGroup2;
    @Column(name = "customer_hi_group")
    private String customerHiGroup;
    @Column(name = "customer_site")
    private String customerSite;
    @Column(name = "search_text")
    private String searchText;
    @Column(name = "tax_gu")
    private String taxGu;
    @Column(name = "tax_customer_code")
    private String taxCustomerCode;
    @Column(name = "customer_reg_code")
    private String customerRegCode;
    @Column(name = "mobile_number")
    private String mobileNumber;
    @Column(name = "app_company")
    private String appCompany;
    @Column(name = "payment_ar")
    private String paymentAr;
    @Column(name = "payment_ap")
    private String paymentAp;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name="customer_group_id")
    private CustomerGroup customerGroup;


}
```





- 연관관계 테스트

``` java
@Test
@DisplayName("거래처 그룹 생성과 거래처 생성 동시 진행 테스트")
void create_all(){
    CustomerGroup customerGroup = CustomerGroup.builder()
            .customerGroup1("customerGroup1")
            .customerGroup2("customerGroup2")
            .customerGroup1Name("customerGroup1Name")
            .customerGroup2Name("customerGroup2Name")
            .customerHiGroup("customerHiGroup")
            .customerHiGroupName("customerHiGroupName")
            .companyCode("newone")
            .etcDesc("비고 없음")
            .build();


    CustomerManagement customerManagement = new CustomerManagement();
    customerManagement.setCustomerCode("testCode");
    customerManagement.setBossName("test");
    // 연관관계 메서드로 값추가
    customerGroup.addCustomerManagement(customerManagement);

    // 한번에 save를 통해서 저장
    customerGroupRepository.save(customerGroup);

    log.info("customer {} " , customerGroup.toString());
    log.info("customer {} " , customerManagement.toString());
    assertThat(customerGroup).isEqualTo(customerGroupRepository.findAll().get(0));


}
```



