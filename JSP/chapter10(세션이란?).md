

# 세션(Session)

### 세션(Session)은 클라이언트와 서버 간의 상태를 유지(stateful)하기 위해 사용되어집니다

- 일정 시간 동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 유지시키는 기술입니다.

- 여기서의 상태는 대표적으로 로그인 정보가 있습니다.
- 사용자가 브라우저를 닫아 서버와의 연결을 끝내는 시점까지를 세션이라고도 합니다.
- 서버는 세션을 사용해서 클라이언트의 상태를 유지할 수 있기 때문에 로그인한 사용자 정보를 유지하기 위한 목적으로 세션을 주로 사용합니다.
- 세션은 서버 메모리에 저장되어집니다.



### 세션의 특징

- 세션 특징

  - 웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장한다.
  - 웹 서버의 저장되는 쿠키(=세션 쿠키)
  - 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제가 되므로, 쿠키보다 비교적 보안이 좋다.
  - 저장 데이터에 제한이 없다. (서버 용량이 허용하는 한에서)
  - 각 클라이언트에 고유 Session ID를 부여한다. 
    - Session ID로 클라이언트를 구분해 각 요구에 맞는 서비스를 제공

  

### 세션 ID

- 클라이언트마다 별도의 세션을 가지기 때문에 각 세션을 구분하기 위해 세션마다 고유 ID를 할당합니다.
- 이를 세션 ID 라고 합니다.

- 세션ID를 서버와 클라이언트 사이에서 공유할 수 있는 방법이 필요한데 이때  Http cookie 헤더를 통해서 http method안에 쿠키를 담아서 주고받게 됩니다.

### 세션의 동작방식

**세션 생성**:

- 클라이언트가 서버에 첫 요청을 보내면 서버는 고유한 세션 ID를 생성하고, 클라이언트에게 이를 반환합니다.
  - http 메시지의  response header 중 Set-cookies 헤더에 세션 id를 담아서 보냅니다.
- 클라이언트는 서버로 부터 받은 session id를 쿠키에 보관합니다.

**세션 유지**:

- 클라이언트는 이후 요청마다 쿠키의 세션 ID를 requets header의 cookie에 담아서 서버로 전달합니다.
- 서버는 전달받은 세션 ID를 기반으로 클라이언트를 식별하고 저장된 데이터를 사용합니다.

**세션 종료**:

- 세션은 일정 시간 동안 클라이언트의 활동이 없으면 만료될 수 있습니다

  - (기본적으로 세션 타임아웃 설정).

- 클라이언트가 명시적으로 로그아웃할 경우에도 세션은 삭제됩니다

  

💡 **세션값 설정하기**  

>  session.setAttribute("설정한 세션아이디", 세션에 넣을 값);  
>  session.setAttribute("user_id", user_id);  

💡 **세션유지시간 설정하기(초 단위)**

> session.setMaxInactiveInterval(30*60); // 60분동안 세션을 유지하고 싶다면, 60 * 60으로 설정
> session.setMaxInactiveInterval(-1);   // 세션의 시간을 무한대로 설정 

💡 **세션에 저장된 값 가져오기** 

>   session.getAttribute("user_id");

💡 **세션값 삭제**

>   session.removeAttribute("user_id"); 
>   session.invalidate(); // 세션 전체 제거, 무효화 



### 세션을 사용한 로그인 상태 유지

1. 로그인에 성공하면 session 기본 객체의 특정 속성에 데이터를 기록한다.
2. 이후로 session 기본 객체의 특정 속성이 존재하면 로그인한 것으로 간주합니다.
3. 로그아웃할 경우 session.invalidate() 메서드를 호출하여 세션을 종료합니다.



### 쿠키와 세션의 가장 큰 차이점은?

- 큰 차이점은 사용자의 정보가 저장되는 위치이다. 쿠키는 서버의 자원을 전혀 사용하지 않으며, 세션은 서버의 자원을 사용

  

