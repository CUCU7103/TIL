# chapter04(JSP 처리 과정 ~)

# JSP 처리 과정

- #### JSP(Java Server pages)

  - JSP는 Java Server Pages의 약자로, 동적인 웹 페이지를 생성하기 위해 사용됩니다. 
  - JSP는 HTML 코드 안에 자바 코드를 삽입하여 서버에서 실행되도록 합니다.

- 서블릿

  - 서블릿은 자바 클래스의 일종으로, 클라이언트의 요청을 처리하고 응답을 생성하는 역할을 합니다.

- **웹 서버**: 

  - 정적인 데이터만 처리하는 서버(HTML, img 등)

- **WAS(Web Application Server)**: 

  - 동적 데이터를 처리하는 서버(DB 등) 비즈니스 로직 처리

##  JSP / 서블릿 컴파일 처리 과정

- 웹 브라우저에서 jsp 페이지에 해당하는 URL을 입력하면 아래 그림과 같은 처리과정을 거칩니다.

![image-20241119010157089](https://github.com/CUCU7103/typora_images/blob/main/image/image-20241119010157089.png)

- WAS는 JSP 페이지에 대한 요청이 들어오면 

  **1. JSP와 관련된 서블릿 클래스가 없는 경우** (1.1)

  - JSP 페이지로부터 자바 코드를 생성한다. (1.2)

  - 자바 코드를 컴파일해서 서블릿 클래스를 생성한다. (1.3)

  - 변환된 서블릿 클래스를 실행하고, WAS의 메모리에 적재된다.

  - 서블릿에 클라이언트 요청을 전달한다. (2.1)

  - 서블릿의 요청을 처리한 결과를 응답으로 생성한다. (2.2)

  - 응답을 웹 브라우저에 전송한다. (3)

    

  **2. JSP에 해당하는 서블릿이 존재하는 경우**(즉, 이미 과정 1.1 ~ 1.3을 거친 경우)

  - 서블릿에 클라이언트 요청을 전달한다. (2.1)

  - 서블릿의 요청을 처리한 결과를 응답으로 생성한다. (2.2)

  - 응답을 웹 브라우저에 전송한다. (3)

    

JSP 페이지를 요청할때는 JSP를 직접 실행하는 것이 아니라 JSP를 자바 소스코드로 변환한뒤 컴파일 해서 생성된 서블릿을 실행하는 것 입니다.

- 즉 JSP를 실행한다는 것은 JSP 페이지를 컴파일한 서블릿 클래스를 실행한다는 것입니다.

- JSP을 자바코드로 변환하는 단계를 변환(ranslation)단계이라고 하고 

- 자바코드를 서블릿 클래스로 변경하는 것을 컴파일(complie)단계라고 합니다.



### 출력버퍼

- JSP 페이지가 생성하는 출력내용을 모으는 곳입니다.



출력버퍼의 장점

- 데이터 전송 성능 향상

  - 한 번에 큰 단위의 데이터 전송이 작은 데이터를 여러차례 보내는 것보다 효과적입니다.

- JSP 실행 도중에 버퍼를 비우고 새로운 내용 전송

  - JSP 페이지가 생성한 결과는 일단 출력 버퍼에 저장되기 때문에, 버퍼가 일정 용량을 넘지 않는 이상 웹 브라우저에 데이터를 전송하지 않는다

  - 이러한 과정으로 인해서, JSP 페이지 실행 도중에 버퍼에 보관된 데이터를 지우고 새로운 내용을 전송할 수 있다

  - 예를 들어서, 에러가 발생하면 버퍼의 내용을 전부 지우고 에러 화면을 출력한다

    

- 버퍼가 다 차기 전까지 Http 프로토콜의 헤더 변경이 가능합니다.

  - 버퍼 내용을 웹 브라우저에 전송하기 전까지 헤더 정보를 얼마든지 변경할 수 있지만, 버퍼 내용이 웹 브라우저에 보내지면 헤더 정보는 절대 변경 불가능하다



버퍼를 사용하여 데이터를 전송하는 방식은 아래 그림과 같다.

![image-20241119013823706](https://github.com/CUCU7103/typora_images/blob/main/image/image-20241119013823706.png)

- 플러쉬(flush)
  - 버퍼가 다 찼을 때, 버퍼에 쌓인 데이터를 실제로 전송되어야 할 곳(또는 저장되어야 할 곳)에 전송하고(또는 저장하고) 버퍼를 비우는 것을 플러시라고 한다



## 웹 어플리케이션 폴더 구성과 URL 매핑

- 서블릿/JSP로 구성된 기본 폴더 구조는 다음과 같습니다.

![image-20241119014245047](https://github.com/CUCU7103/typora_images/blob/main/image/image-20241119014245047.png)

- WEB-INF : 웹 어플리케이션 설정 정보를 담고 있는 web.xml 파일이 위치한다.
- WEB-INF\classes : 웹 어플리케이션에서 사용하는 클래스 파일이 위치한다.
- WEB-INF\lib : 웹 어플리케이션에서 사용하는 jar 파일이 위치한다.

WEB-INF와 그 하위 폴더를 제외한 나머지 폴더에는 웹 어플리케이션에서 사용할 JSP, HTML, 이미지 파일등이 존재합니다. 

## 웹 어플리케이션 폴더와 URL의 관계

- 한 개의 웹 어플리케이션은  한 개의 폴더를 차지합니다.

- **톰캣에서 웹 어플리케이션은 [톰캣]\webapps 폴더에 위치합니다.** 
- **[톰캣]\webapps 폴더에 있는 하위 폴더는 자동으로 웹 어플리케이션에 포함되어집니다.** 
- 각 폴더의 이름은 웹 어플리케이션을 실행할 때 사용되는 URL과 관련이 있습니다.

``` jsp
 [톰캣]\webapps\[웹경로] -> http://host:port[/웹경로]

webapps\chap02 -> http://localhost:8080/chap02
webapps\chap03 -> http://localhost:8080/chap03
webapps\chap04 -> http://localhost:8080/chap04
```

이때 http://localhost:8080/chap04 에서 웹 애플리켕셔의 경로에 해당하는 /chop04 부분을 

컨텍스트 패스(Context-path)라고 합니다.

컨텍스트 패스(Context-path)

- 웹 어플리케이션 서버(Web Application Server) = Tomcat에서 웹상의 어플리케이션들을 구분하기 위한 Path입니다.



## 웹 어플리케이션 폴더 내에서의 하위 폴더 사용

- jsp 파일을 모두 한 폴더에서 관리하는 것은 유지보수가 매우 어렵다.
- 웹 어플리케이션 폴더 및에 기능별로 하위 페이지를 생성하여  jsp 페이지를 기능별로 분류하는 방법으로 유지보수를 좀 더 쉽게 할 수있습니다.



## 웹 어플리케이션 배포

웹 어플리케이션을 WAS에 배포하는 방법은 2가지가 있습니다.

- 대상 폴더에 직접 복사
- war 파일로 배포
